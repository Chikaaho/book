<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>更新图书</title>
</head>
<style>
    .bookform {
        margin-left: 50px;
        height: 90px;
        margin-top: 10px;
        width: 90%;
        font-size: 16px;
        font-weight: bolder;
    }

    .inp {
        width: 50px;
        height: 50px;
        float: left;
        margin-left: 18%;
        margin-top: 15px;
    }

    .but {
        width: 80px;
        padding: 8px;
        background-color: green;
        color: #fff;
        border-radius: 10px;
        text-align: center;
        vertical-align: middle;
        font-weight: 900;
    }

    #logout:visited {
        color: #fff;
    }

    .but:hover {
        cursor: pointer;
    }

    .btn_form {
        width: 200px;
        height: 100px;
        margin-right: 5%;
        float: right;
        bottom: 10px;
    }
</style>
<link rel="stylesheet" href="../../static/dhl.css">
<link rel="icon" href="../../static/Icons/trans3.ico">
<body style="margin: 0">
<ul id="nav">
    <li><a th:href="@{/books/toIndex}">首页</a></li>
    <li><a th:href="@{/books/tpAddPage}">添加图书</a></li>
    <li><a th:href="@{/books/toUpdatePage}">更新图书</a></li>
</ul>
<div class="but" style="background-color: black;right:2%;top:12%;position: absolute">
    <a th:href="@{/user/logout}" id="logout" style="text-decoration: none">注销</a>
</div>
<table style=" border:0">
    <tr>
        <th style="width:1500px; height:150px; border:1px;">
            <center>
                <table>
                    <th style="font-size: 50px;color: #fd7e14">图书操作</th>
                </table>
            </center>
        </th>
    </tr>
</table>

<div id="allbook">
    <div class="bookform">
        <span class="inp">书名</span>
        <span class="inp">简介</span>
        <span class="inp">数量</span>
        <span class="inp">操作</span>
        <input type="text" placeholder="请输入您想搜索的书名关键词" style="width: 180px;position: absolute;top: 32%;right: 6%"
               v-model="selected" @input="selectOneBook()">
    </div>
    <hr style="width: 90%">
    <div v-for="item in info.data" class="bookform">
        <span>{{ booknamesub() }}</span>
        <span class="inp">{{ item.bookName }}</span>
        <span class="inp">{{ item.bookMsg }}</span>
        <span class="inp">{{ item.bookStock }}</span>
        <br>
        <div class="btn_form">
            <span class="but" @click="update(item)">更改</span>
            <span class="but" @click="deletes(item)" style="background-color: red">删除</span>
        </div>

    </div>
    <form th:action="@{/books/updateBook}" method="post">
        <div v-show="show"
             style="background-color:#FDF5E6;z-index:101;border-radius: 5%;width: 500px;height: 500px;position: fixed;margin-left: 35%;bottom: 10%;font-weight: bolder;text-align: center">
            <div style="height: 50px;width: 100%;margin-top: 30px;font-size: 20px">您正在修改编号为'{{ bookNumber }}' ，名为'{{
                bookName }}'的图书信息
            </div>
            <br>
            <input type="text" id="bkid" hidden="hidden" v-model="bookId" name="bookId">
            <input type="text" id="bkNumber" hidden="hidden" v-model="bookNumber" name="bookNumber">
            <div style="margin-top: 10%">书名：<input type="text" id="bkname" placeholder="请输入要修改的书名" name="bookName">
            </div>
            <br>
            <div style="margin-top: 10%">简介：<input type="text" id="bkdetail" placeholder="请输入要修改的图书简介 " name="bookMsg">
            </div>
            <br>
            <div style="margin-top: 10%">数量: <input type="text" placeholder="请输入要修改的图书数量" name="bookStock"></div>
            <br>
            <div style="margin-top: 10%"><input type="submit" value="提交"><input type="button" value="关闭"
                                                                                @click="close()"></div>
        </div>
    </form>
    <div style="color:black;background-color:rgba(0,0,0,0.5);z-index:100;width: 100%;height: 100%;position: fixed;top: 0;bottom: 0"
         v-show="show"></div>

</div>
</body>
<link rel="stylesheet" href="../../static/dhl.css">
<script src="../../static/axios-master/dist/axios.js"></script>
<script src="../../static/vue/vue.js"></script>
<script type="text/javascript" src="../../static/jquery-3.5.1.min.js"></script>
<script>
    var vue = new Vue({
        el: '#allbook',

        methods: {
            booknamesub: function () {
                for (i = 0; i < this.info.data.length; i++) {
                    if (this.info.data[i].bookName.length > 10) {
                        this.info.data[i].bookName = this.info.data[i].bookName.substr(0, 9) + '...'
                    }
                    if (this.info.data[i].bookMsg.length > 10) {
                        this.info.data[i].bookMsg = this.info.data[i].bookMsg.substr(0, 9) + '...'
                    }
                }
            },

            update: function (self) {
                this.show = true
                this.bookName = self.bookName
                this.bookId = self.bookId
                this.bkdetail = self.bookMsg
                this.bknum = self.bookStock
                this.bookNumber = self.bookNumber
            },
            close: function () {
                this.show = false
            },
            deletes: function (self) {
                $.ajax(
                    {
                        url: 'http://localhost:8080/books/deleteBook',
                        data:
                            {bookId: self.bookId}
                        ,
                        type: 'POST'
                    })
                alert('删除成功')
                history.go(0)
            },
            selectOneBook: function () {
                if (this.count == 1) {
                    this.count += 1
                    var a = []
                    for (i = 0; i < this.info.data.length; i++) {
                        a.push(this.info.data[i])
                    }
                    this.info2 = a
                }
                this.info.data = this.info2.filter(item => item.bookName.search(this.selected) != -1)

            }

        },
        data() {
            return {
                count: 1,
                info: [],
                selected: '',
                show: false,
                bkname: '',
                bookId: 0,
                bkdetail: '',
                bknum: 0,
                bookId: null,
                bookName: null,
                bookMsg: null,
                bookStock: null,
                bookNumber: null,
                a: []
            }
        },
        mounted() {
            axios.get('http://localhost:8080/books/selectAll').then(response => (this.info = response))

        }
    })

</script>